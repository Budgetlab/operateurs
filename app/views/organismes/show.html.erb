<main role="main">
  <div class="fr-container" data-controller="toggle">
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-9">
        <h1 class="fr-my-6w"><%= @organisme.nom %> <% if @organisme.statut != "valide" %><p class="fr-badge fr-badge--new fr-badge--no-icon">Brouillon</p><% end %></h1>
      </div>
      <div class="fr-col-12 fr-col-lg-3">
        <% if @organisme.statut != "valide" %><div class="fr-my-6w"><%= link_to edit_organisme_path(@organisme.id), class: "fr-btn" do %>Reprendre le brouillon<%end %></div><%end %>
      </div>
    </div>
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-4">
        <p class="fr-hint-text">Cliquez sur les interrupteurs ci-dessous pour faire apparaître ou disparaître des sections.</p>
        <ul class="fr-toggle__list">
          <li>
            <div class="fr-toggle fr-toggle--border-bottom fr-toggle--label-left">
              <input type="checkbox" checked="true" class="fr-toggle__input" id="group-4-toggle-0" data-action="change->toggle#toggle" data-section="fiche_identite">
              <label class="fr-toggle__label" for="group-4-toggle-0" data-fr-checked-label="Activé" data-fr-unchecked-label="Désactivé">Fiche d’identité</label>
            </div>
          </li>
          <li>
            <div class="fr-toggle fr-toggle--border-bottom fr-toggle--label-left">
              <input type="checkbox" checked="true" class="fr-toggle__input" id="group-4-toggle-1" data-action="change->toggle#toggle" data-section="regime_budgetaire">
              <label class="fr-toggle__label" for="group-4-toggle-1" data-fr-checked-label="Activé" data-fr-unchecked-label="Désactivé">Régime budgétaire et comptable</label>
            </div>
          </li>
          <li>
            <div class="fr-toggle fr-toggle--border-bottom fr-toggle--label-left">
              <input type="checkbox" checked="true" class="fr-toggle__input" id="group-4-toggle-2" data-action="change->toggle#toggle" data-section="controle">
              <label class="fr-toggle__label" for="group-4-toggle-2" data-fr-checked-label="Activé" data-fr-unchecked-label="Désactivé">Contrôle</label>
            </div>
          </li>
          <li>
            <div class="fr-toggle fr-toggle--border-bottom fr-toggle--label-left">
              <input type="checkbox" checked="true" class="fr-toggle__input" id="group-4-toggle-3" data-action="change->toggle#toggle" data-section="tutelles">
              <label class="fr-toggle__label" for="group-4-toggle-3" data-fr-checked-label="Activé" data-fr-unchecked-label="Désactivé">Tutelles financière et technique</label>
            </div>
          </li>
          <li>
            <div class="fr-toggle fr-toggle--border-bottom fr-toggle--label-left">
              <input type="checkbox" checked="true" class="fr-toggle__input" id="group-4-toggle-4" data-action="change->toggle#toggle" data-section="gouvernance">
              <label class="fr-toggle__label" for="group-4-toggle-4" data-fr-checked-label="Activé" data-fr-unchecked-label="Désactivé">Gouvernance DB</label>
            </div>
          </li>
          <li>
            <div class="fr-toggle fr-toggle--border-bottom fr-toggle--label-left">
              <input type="checkbox" checked="true" class="fr-toggle__input" id="group-4-toggle-5" data-action="change->toggle#toggle" data-section="categories">
              <label class="fr-toggle__label" for="group-4-toggle-5" data-fr-checked-label="Activé" data-fr-unchecked-label="Désactivé">Catégories</label>
            </div>
          </li>
        </ul>
      </div>

      <div class="fr-col-12 fr-col-lg-8">
        <div id="fiche_identite" class="fr-mb-4w">
          <h2>Fiche d'identité <%= link_to edit_organisme_path(@organisme, step: 1), class: "fr-btn fr-btn--secondary" do %>Modifier<%end %></h2>

          <div class="fr-card">
            <div class="fr-card__body">
            <div class="fr-card__content">
              <h3 class="fr-card__title">
                <% if !@organisme.acronyme.nil? %><%= @organisme.acronyme %> - <%end %><%= @organisme.nom %>
              </h3>
              <p class="fr-card__desc">Siren : <b><%= format_boolean(@organisme.siren) %></b></p>
              <p class="fr-card__desc">Famille : <b><%= format_boolean(@organisme.famille) %></b></p>
              <p class="fr-card__desc">Nature juridique : <b><%= format_boolean(@organisme.nature) %></b></p>
              <p class="fr-card__desc">Date de création : <b><%= format_boolean(format_date(@organisme.date_creation)) %></b></p>
              <p class="fr-card__desc">Bureau DB de rattachement : <b><%= @organisme.bureau.nom %></b></p>
              <p class="fr-card__desc">Texte institutif: <b><%= auto_link(simple_format(format_boolean(@organisme.texte_institutif),{}, wrapper_tag: "span"), :html => { :target => '_blank' }) %></b></p>
              <p class="fr-card__desc">Commentaires : <b><%= format_boolean(@organisme.commentaire) %></b></p>

                <div class="fr-card__start">
                  <ul class="fr-tags-group">
                    <li>
                      <p class="fr-badge fr-badge--green-menthe"><%= @organisme.etat %></p>
                    </li>
                  </ul>
                </div>
            </div>
          </div>
          </div>
        </div>

        <div id="regime_budgetaire" class="fr-mb-4w">
          <h2>Régime budgétaire et comptable</h2>
          <% if @organisme.statut.to_i > 1 || @organisme.statut == "valide"%>
            <div class="fr-card">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h3 class="fr-card__title">
                  GBCP I / III
                </h3>
                <p class="fr-card__desc">Partie I GBCP : <b><%= format_boolean(@organisme.gbcp_1) %></b></p>
                <p class="fr-card__desc">Présence d’un agent comptable : <b><%= format_boolean(@organisme.agent_comptable_present) %></b></p>
                <p class="fr-card__desc">Champs application degré GBCP : <b><%= format_boolean(@organisme.degre_gbcp) %></b></p>
                <p class="fr-card__desc">Partie III GBCP : <b><%= format_boolean(@organisme.gbcp_3) %></b></p>
                <p class="fr-card__desc">Comptabilité budgétaire : <b><%= format_boolean(@organisme.comptabilite_budgetaire) %></b></p>
              </div>
            </div>
          </div>
          <%else  %>
            <p class="fr-badge fr-badge--warning">Non complété</p>
          <%end %>
        </div>

        <div id="controle" class="fr-mb-4w">
          <h2>Contrôle</h2>
          <% if @organisme.statut.to_i > 2 || @organisme.statut == "valide"%>
          <div class="fr-card">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h3 class="fr-card__title">
                  Présence contrôle : <%= format_boolean(@organisme.presence_controle) %>
                </h3>
                <p class="fr-card__desc">Controleur référent : <b><%= @organisme.controleur.nom %></b></p>
                <p class="fr-card__desc">Nature contrôle : <b><%= format_boolean(@organisme.nature_controle) %></b></p>
                <p class="fr-card__desc">Référence du texte de soumission au contrôle : <b><%= auto_link(simple_format(format_boolean(@organisme.texte_soumission_controle),{}, wrapper_tag: "span"), :html => { :target => '_blank' }) %></b></p>
                <p class="fr-card__desc">Autorité de contrôle : <b><%= format_boolean(@organisme.autorite_controle) %></b></p>
                <p class="fr-card__desc">Texte reglementaire de désignation de l'autorité de contrôle : <b><%= auto_link(simple_format(format_boolean(@organisme.texte_reglementaire_controle),{}, wrapper_tag: "span"), :html => { :target => '_blank' }) %></b></p>
                <p class="fr-card__desc">Référence de l’arrêté de contrôle : <b><%= auto_link(simple_format(format_boolean(@organisme.arrete_controle),{}, wrapper_tag: "span"), :html => { :target => '_blank' }) %></b></p>
                <p class="fr-card__desc">Document de contrôle : <b><%= format_boolean(@organisme.document_controle_present) %></b></p>
                <p class="fr-card__desc">Date de signature du document : <b><%= format_boolean(format_date(@organisme.document_controle_date)) %></b></p>
                <p class="fr-card__desc">Lien du document de contrôle : <b><%= auto_link(simple_format(format_boolean(@organisme.document_controle_lien),{}, wrapper_tag: "span"), :html => { :target => '_blank' }) %></b></p>
                <p class="fr-card__desc">Référence de l’arrêté de nomination du commissaire du gouvernement : <b><%= auto_link(simple_format(format_boolean(@organisme.arrete_nomination),{}, wrapper_tag: "span"), :html => { :target => '_blank' }) %></b></p>
              </div>
            </div>
          </div>
          <%else  %>
            <p class="fr-badge fr-badge--warning">Non complété</p>
          <% end %>
        </div>

        <div id="tutelles" class="fr-mb-4w">
          <h2>Tutelles financière et technique</h2>
          <% if @organisme.statut.to_i > 3 || @organisme.statut == "valide"%>
          <div class="fr-card">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h3 class="fr-card__title">
                  Tutelle financière : <%= format_boolean(@organisme.tutelle_financiere) %>
                </h3>
                <p class="fr-card__desc">Délégation de l'approbation des BI / BR / comptes financiers : <b><%= format_boolean(@organisme.delegation_approbation) %></b></p>
                <p class="fr-card__desc">Autorité chargée de l’approbation : <b><%= format_boolean(@organisme.autorite_approbation) %></b></p>
                <p class="fr-card__desc">Ministère de tutelle principale : <b><%= @organisme.ministere.nom %></b></p>
                <p class="fr-card__desc">Ministère•s de co-tutelle : <b></b></p>
               </div>
            </div>
          </div>
          <%else  %>
            <p class="fr-badge fr-badge--warning">Non complété</p>
          <%end %>
        </div>

        <div id="gouvernance" class="fr-mb-4w">
          <h2>Gouvernance DB</h2>
          <% if @organisme.statut.to_i > 4 || @organisme.statut == "valide"%>
          <div class="fr-card">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h3 class="fr-card__title">
                  Admin DB : <%= format_boolean(@organisme.admin_db_present) %>
                </h3>
                <p class="fr-card__desc">Fonction Admin DB : <b><%= format_boolean(@organisme.admin_db_fonction) %></b></p>
                <p class="fr-card__desc">Présence DB au préCA : <b><%= format_boolean(@organisme.admin_preca) %></b></p>
                <p class="fr-card__desc">Présence contrôleur au pré-CA : <b><%= format_boolean(@organisme.controleur_preca) %></b></p>
                <p class="fr-card__desc">Présence contrôleur au CA : <b><%= format_boolean(@organisme.controleur_ca) %></b></p>
                <p class="fr-card__desc">Comité d’audit et des risques : <b><%= format_boolean(@organisme.comite_audit) %></b></p>
              </div>
            </div>
          </div>
          <%else  %>
            <p class="fr-badge fr-badge--warning">Non complété</p>
          <%end %>
        </div>

        <div id="categories" class="fr-mb-4w">
          <h2>Catégories</h2>
          <% if @organisme.statut == "valide" %>
          <div class="fr-card">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h3 class="fr-card__title">
                  APU : <b><%= format_boolean(@organisme.apu) %></b>
                </h3>
                <p class="fr-card__desc">Soumission à la CIASSP année [N] : <b><%= format_boolean(@organisme.ciassp_n) %></b></p>
                <p class="fr-card__desc">Soumission à la CIASSP année [N-1] : <b><%= format_boolean(@organisme.ciassp_n1) %></b></p>
                <p class="fr-card__desc">ODAC Liste INSEE année [N] : <b><%= format_boolean(@organisme.odac_n) %></b></p>
                <p class="fr-card__desc">ODAC Liste INSEE année [N-1] : <b><%= format_boolean(@organisme.odac_n1) %></b></p>
                <p class="fr-card__desc">ODAL Liste INSEE année [N] : <b><%= format_boolean(@organisme.odal_n) %></b></p>
                <p class="fr-card__desc">ODAL Liste INSEE année [N-1] : <b><%= format_boolean(@organisme.odal_n1) %></b></p>
              </div>
            </div>
          </div>
          <%else  %>
            <p class="fr-badge fr-badge--warning">Non complété</p>
          <%end %>
        </div>

      </div>
    </div>
  </div>
</main>